{% extends 'base.html' %} {% block content %}
<div class="row">
  <div class="col-md-12">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="text-secondary">Student List</h2>
      <form class="d-flex" action="{{ url_for('index') }}" method="GET">
        <input
          class="form-control me-2"
          type="search"
          placeholder="Search name"
          name="q"
          value="{{ request.args.get('q', '') }}"
        />
        <button class="btn btn-outline-primary" type="submit">Search</button>
      </form>
      <div>
        <a
          href="{{ url_for('export_data', q=search_query) }}"
          class="btn btn-outline-success shadow-sm me-2"
        >
          <i class="bi bi-file-earmark-spreadsheet"></i> Export CSV
        </a>
        <a
          href="{{ url_for('add_student') }}"
          class="btn btn-success shadow-sm"
        >
          <i class="bi bi-plus-lg"></i> + Add New Student
        </a>
      </div>
    </div>

    <div class="card">
      <div class="card-body p-0">
        <table class="table table-hover table-striped mb-0">
          <thead class="table-dark">
            <tr>
              <th class="ps-4">Reg No</th>
              <th>
                <a
                  href="{{ url_for('index', sort_by='name', order='desc' if sort_by == 'name' and order == 'asc' else 'asc', q=search_query) }}"
                  class="text-white text-decoration-none"
                >
                  Name {% if sort_by == 'name' %}
                  <i
                    class="bi bi-arrow-{{ 'up' if order == 'asc' else 'down' }}"
                  ></i>
                  {% endif %}
                </a>
              </th>
              <th>
                <a
                  href="{{ url_for('index', sort_by='branch', order='desc' if sort_by == 'branch' and order == 'asc' else 'asc', q=search_query) }}"
                  class="text-white text-decoration-none"
                >
                  Branch {% if sort_by == 'branch' %}
                  <i
                    class="bi bi-arrow-{{ 'up' if order == 'asc' else 'down' }}"
                  ></i>
                  {% endif %}
                </a>
              </th>
              <th class="text-end pe-4">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for student in students %}
            <tr>
              <td class="ps-4 align-middle fw-bold">{{ student['regno'] }}</td>
              <td class="align-middle">{{ student['name'] }}</td>
              <td class="align-middle">
                <span class="badge bg-info text-dark"
                  >{{ student['branch'] }}</span
                >
              </td>
              <td class="text-end pe-4">
                <a
                  href="{{ url_for('update_student', regno=student['regno']) }}"
                  class="btn btn-sm btn-outline-primary me-1"
                  >Edit</a
                >
                <a
                  href="{{ url_for('delete_student', regno=student['regno']) }}"
                  class="btn btn-sm btn-outline-danger"
                  onclick="return confirm('Are you sure you want to delete this student?');"
                  >Delete</a
                >
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="4" class="text-center py-4 text-muted">
                No students found. Add one to get started!
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    {% if total_pages > 1 %}
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center mt-4">
        <li class="page-item {% if page == 1 %}disabled{% endif %}">
          <a
            class="page-link"
            href="{{ url_for('index', page=page-1, q=search_query, sort_by=sort_by, order=order) }}"
            >Previous</a
          >
        </li>
        {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if p == page %}active{% endif %}">
          <a
            class="page-link"
            href="{{ url_for('index', page=p, q=search_query, sort_by=sort_by, order=order) }}"
            >{{ p }}</a
          >
        </li>
        {% endfor %}
        <li class="page-item {% if page == total_pages %}disabled{% endif %}">
          <a
            class="page-link"
            href="{{ url_for('index', page=page+1, q=search_query, sort_by=sort_by, order=order) }}"
            >Next</a
          >
        </li>
      </ul>
    </nav>
    {% endif %}
  </div>
</div>
{% endblock %}
